image: node:latest

cache:
  paths:
  - node_modules/

stages:
  - test
  - build

install_dependencies:
  stage: build
  script:
    - npm install
    - echo $MONGO_URL
    - node /bin/www
  artifacts:
    paths:
      - node_modules/
  services:
    - mongo:3.2
  variables:
    MONGO_URL: mongodb://mongo:27017/todos

build_image:
  stage: build
  image: docker:latest
  services:
    - docker:dind
  script:
    - docker info
    - docker build -t todo-apps-api .
    - docker images
  tags:
    - docker

testing_apps:
  stage: test
  script: 
    - npm test
    - npm run coverage


